{
    "collab_server" : "",
    "contents" : "rm(list=ls())\ngc()\nlibrary(data.table)\nlibrary(magrittr)\nlibrary(ggplot2)\nlibrary(ggpubr)\n\n# # NBSS data import --------------------------------------------------------\n\nUSA <- read.csv('data/nbss_us_states.csv') %>% as.data.table\nUSA[,date:=as.Date(date)]\nsetkey(USA,state,date)\nX <- read.csv('data/nbss_countries.csv') %>% as.data.table\n\nSWE <- X[country=='Sweden']\nSWE[,date:=as.Date(date)]\nUSA[,growth_rate:=shift(growth_rate,10),by=state]\nSWE[,growth_rate:=shift(growth_rate,10)]\n# State interventions -----------------------------------------------------\n\nAZ <- USA[state=='Arizona']\nNY <- USA[state=='New York']\nFL <- USA[state=='Florida']\nTX <- USA[state=='Texas']\nMN <- USA[state=='Minnesota']\nCA <- USA[state=='California']\nLA <- USA[state=='Louisiana']\n\n# \n# xx <- covid19(country = 'United States',level=2) %>% as.data.table\n# xx[,state:=administrative_area_level_2]\n# NY <- xx[state=='New York']\n# NY[,new_confirmed:=c(confirmed[1],diff(confirmed))]\n# NY <- nbss(NY,level='SEIR')\n# NY[,deaths_pc:=deaths/population]\n# NY[,growth_rate:=shift(growth_rate,10)]\n\n# Arizona -----------------------------------------------------------------\n\nAZ[date<as.Date('2020-03-30'),intervention:='pre-stay-at-home']\nAZ[date>=as.Date('2020-03-30') & date<as.Date('2020-05-15'),intervention:='stay-at-home']\nAZ[date>=as.Date('2020-05-15') & date<as.Date('2020-06-17'),intervention:='relaxation']\nAZ[date>=as.Date('2020-06-17'),intervention:='local mask-wearing mandate']\nAZ[date>as.Date('2020-06-29'),intervention:='reopening_reversal']\nAZ[,intervention:=factor(intervention,levels=unique(intervention))]\n\n\n\naz <- ggplot(AZ,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  geom_line(data=AZ[intervention=='reopening_reversal'],color='red',lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle('Arizona')\n\naz.rt <- ggplot(AZ[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  geom_vline(xintercept = AZ[grepl('local',intervention),min(date)])+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\naz.cs <- ggplot(AZ[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\naz2=az+annotation_custom(ggplotGrob(az.rt),\n                     xmin=log(3e-4),xmax=log(3e-3),\n                     ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(az.cs),\n                    xmin=log(2.8e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n# Texas -------------------------------------------------------------------\n\nTX[date<as.Date('2020-03-31'),intervention:='pre-stay-at-home']\nTX[date>=as.Date('2020-03-31') & date<as.Date('2020-05-01'),intervention:='stay-at-home']\nTX[date>=as.Date('2020-05-01') & date<as.Date('2020-05-18'),intervention:='Phase 1']\nTX[date>=as.Date('2020-05-18') & date<as.Date('2020-06-03'),intervention:='Phase 2']\nTX[date>=as.Date('2020-06-03') & date<as.Date('2020-06-26'),intervention:='Phase 3']\nTX[date>=as.Date('2020-06-26'),intervention:='reopening_reversal']\nTX[,growth_rate:=shift(growth_rate,n=3,type='lead')]\nTX[,intervention:=factor(intervention,levels=unique(intervention))]\n\ntx <- ggplot(TX,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  geom_line(data=TX[intervention=='reopening_reversal'],color='red',lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle('Texas')\n\ntx.rt <- ggplot(TX[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  geom_vline(xintercept = TX[grepl('reversal',intervention),min(date)])+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\ntx.cs <- ggplot(TX[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\ntx2=tx+annotation_custom(ggplotGrob(tx.rt),\n                        xmin=log(3e-4),xmax=log(3e-3),\n                        ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(tx.cs),\n                    xmin=log(2.65e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n# New York ----------------------------------------------------------------\n# NY[date<as.Date('2020-03-23'),intervention:='pre_stay-at-home']\n# NY[date>=as.Date('2020-03-23') & date<as.Date('2020-05-19'),intervention:='stay-at-home']\n# NY[date>=as.Date('2020-05-19') & date<as.Date('2020-06-22'),intervention:='reopening']\n\n# ggplot(NY,aes(deaths_pc,growth_rate,color=intervention))+\n#   geom_line(lwd=2)+\n#   scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n#   scale_y_continuous(limits=c(-0.2,0.6))\n\n# Louisiana ---------------------------------------------------------------\nLA[date<as.Date('2020-03-23'),intervention:='pre-stay-at-home']\nLA[date>=as.Date('2020-03-23') & date<as.Date('2020-05-15'),intervention:='stay-at-home']\nLA[date>=as.Date('2020-05-15') & date<as.Date('2020-06-05'),intervention:='Phase 1']\nLA[date>=as.Date('2020-06-05'),intervention:='Phase 2']\n\nLA[,intervention:=factor(intervention,levels=unique(intervention))]\n\nla <- ggplot(LA,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle('Louisiana')\n\nla.rt <- ggplot(LA[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\nla.cs <- ggplot(LA[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\nla2 <- la+annotation_custom(ggplotGrob(la.rt),\n                        xmin=log(3e-4),xmax=log(3e-3),\n                        ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(la.cs),\n                    xmin=log(2.8e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n# Florida -----------------------------------------------------------------\nFL[date<as.Date('2020-03-30'),intervention:='pre-stay-at-home']\nFL[date>=as.Date('2020-03-30') & date<as.Date('2020-06-01'),intervention:='stay-at-home']\nFL[date>=as.Date('2020-06-01'),intervention:='reopening']\nFL[,intervention:=factor(intervention,levels=unique(intervention))]\nfl <- ggplot(FL,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle(\"Florida\")\n\nfl.rt <- ggplot(FL[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\nfl.cs <- ggplot(FL[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\nfl2=fl+annotation_custom(ggplotGrob(fl.rt),\n                        xmin=log(3e-4),xmax=log(3e-3),\n                        ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(fl.cs),\n                    xmin=log(2.6e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n# Minnesota ---------------------------------------------------------------\nMN[date<as.Date('2020-03-27'),intervention:='pre-stay-at-home']\nMN[date>=as.Date('2020-03-27') & date<as.Date('2020-05-18'),intervention:='stay-at-home']\nMN[date>=as.Date('2020-05-18'),intervention:='relaxation']\nMN[,intervention:=factor(intervention,levels=unique(intervention))]\n\nmn <-  ggplot(MN,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle('Minnesota')\n\nmn.rt <- ggplot(MN[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\nmn.cs <- ggplot(MN[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\nmn2=mn+annotation_custom(ggplotGrob(mn.rt),\n                        xmin=log(3e-4),xmax=log(3e-3),\n                        ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(mn.cs),\n                    xmin=log(2.8e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n# California --------------------------------------------------------------\nCA[date<as.Date('2020-03-19'),intervention:='pre-stay-at-home']\nCA[date>=as.Date('2020-03-19') & date<as.Date('2020-05-07'),intervention:='stay-at-home']\nCA[date>=as.Date('2020-05-07') & date<as.Date('2020-06-07'),intervention:='Stage 2']\nCA[date>=as.Date('2020-06-07') & date<as.Date('2020-06-28'),intervention:='Stage 3']\nCA[date>=as.Date('2020-06-28'),intervention:='reopening_reversal']\nCA[,intervention:=factor(intervention,levels=unique(intervention))]\n\nca <-  ggplot(CA,aes(deaths_pc,growth_rate,color=intervention))+\n  geom_line(col='black')+\n  geom_line(data=NY,aes(color='black'),color='black',lwd=2)+\n  geom_line(data=SWE,aes(color='black'),color='grey',lwd=2)+\n  geom_line(lwd=2)+\n  geom_line(data=CA[intervention=='reopening_reversal'],color='red',lwd=2)+\n  scale_x_continuous(trans='log',limits=c(1e-6,3e-3),breaks=10^(-6:0))+\n  scale_y_continuous(limits=c(-0.1,0.4))+\n  theme_bw()+\n  geom_hline(yintercept = 0)+\n  ggtitle('California')\n\nca.rt <- ggplot(CA[date>as.Date('2020-03-01')],\n                aes(date,growth_rate,color=intervention))+\n  geom_line(lwd=2)+\n  geom_point(cex=2)+\n  theme_bw()+\n  theme(legend.position='none')+\n  geom_vline(xintercept = CA[grepl('reversal',intervention),min(date)])+\n  scale_y_continuous('r(t)')+  \n  scale_x_continuous(limits = as.Date(c('2020-03-01','2020-09-01')),\n                     breaks=as.Date(c('2020-03-01','2020-05-01','2020-07-01','2020-09-01')),\n                     labels = c('Mar','May','July','Sep'))\n\nca.cs <- ggplot(CA[date>as.Date('2020-03-01')],\n                aes(date,new_confirmed,fill=intervention))+\n  geom_bar(stat='identity')+\n  theme_bw()+\n  theme(legend.position='none')+\n  scale_y_continuous('N(t)')+\n  scale_x_continuous(name=NULL,breaks=NULL)\n\nca2=ca+annotation_custom(ggplotGrob(ca.rt),\n                        xmin=log(3e-4),xmax=log(3e-3),\n                        ymin=0.07,ymax=0.25)+\n  annotation_custom(ggplotGrob(ca.cs),\n                    xmin=log(2.65e-4),xmax=log(3e-3),\n                    ymin=0.25,ymax=0.4)\n\n\n\n# all ---------------------------------------------------------------------\n\n\n\nggarrange(az2,ca2,fl2,tx2,mn2,la2,nrow=3,ncol=2,align='v')\nggsave('figures/state_intervention_trajectories.png',height=15,width=20)\n\n# ggsave('figures/state_intervention_trajectories.png',height=12,width=15)\n",
    "created" : 1598382448302.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "84158952",
    "id" : "105426C0",
    "lastKnownWriteTime" : 1598390025,
    "last_content_update" : 1598390025512,
    "path" : "~/COVID/deaths_vs_growth_rate/scripts/state_interventions.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}